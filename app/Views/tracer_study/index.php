<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html lang="id">
<head>
  
  <title>Tracer Study IAI Bani Fattah Jombang</title>
  <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Website resmi tracer study IAI Bani Fattah Jombang">
    <meta name="keyword" content="IAIBAFA, SIAKAD, Siakad IAIBAFA, Akademik, Akademik IAIBAFA, e-akademik, Tracer Study IAIBAFA">
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Tracer Study IAI Bani Fattah (IAIBAFA) Jombang" />
    <meta property="og:title" content="Tracer Study IAI Bani Fattah Jombang" />
    <meta property="og:description" content="Website resmi tracer study IAI Bani Fattah (IAIBAFA) Jombang" />
    <meta property="og:url" content="<?=base_url('tracer_study')?>" />
    <meta property="og:image" content="<?=base_url('assets/logo_iaibafa.png');?>" />
    
    <meta itemprop="name" content="Tracer Study IAI Bani Fattah (IAIBAFA) Jombang">
    <meta itemprop="description" content="Website resmi tracer study IAI Bani Fattah Jombang">
    <meta itemprop="image" content="<?=base_url('assets/logo_iaibafa.png');?>">
  <link rel="shortcut icon" href="<?=base_url('assets/logo.ico');?>" type="image/x-icon">
  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="<?=base_url('assets');?>/plugins/fontawesome-free/css/all.min.css">
  <!-- SweetAlert2 -->
<link rel="stylesheet" href="<?=base_url('assets');?>/plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css">
<!-- Select2 -->
<link rel="stylesheet" href="<?=base_url('assets');?>/plugins/select2/css/select2.min.css">
<link rel="stylesheet" href="<?=base_url('assets');?>/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css">
<!-- Tempusdominus Bootstrap 4 -->
<link rel="stylesheet" href="<?=base_url('assets')?>/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
<!-- iCheck -->
<link rel="stylesheet" href="<?=base_url('assets')?>/plugins/icheck-bootstrap/icheck-bootstrap.min.css">
<!-- Daterange picker -->
<link rel="stylesheet" href="<?=base_url('assets');?>/plugins/daterangepicker/daterangepicker.css">
<!-- Toastr -->
<link rel="stylesheet" href="<?=base_url('assets');?>/plugins/toastr/toastr.min.css">
  <!-- Owl Stylesheets -->
    <link rel="stylesheet" href="<?=base_url('assets');?>/plugins/owlcarousel/assets/owl.carousel.min.css">
    <link rel="stylesheet" href="<?=base_url('assets');?>/plugins/owlcarousel/assets/owl.theme.default.min.css">
	<!-- Theme style -->
  	<link rel="stylesheet" href="<?=base_url('assets');?>/dist/css/adminlte.min.css">


</head>
<body class="hold-transition layout-top-nav">
<div class="wrapper">

  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand-md navbar-light navbar-white">
    <div class="container">
      <a href="#" class="navbar-brand">
        <img src="<?=base_url('assets');?>/logo_iaibafa.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: .8">
        <span class="brand-text font-weight-light">Tracer Study IAIBAFA</span>
      </a>
    <!--
      <button class="navbar-toggler order-1" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse order-3" id="navbarCollapse">

        <ul class="navbar-nav">
          <li class="nav-item">
            <a href="index3.html" class="nav-link">Home</a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link">Contact</a>
          </li>
          <li class="nav-item dropdown">
            <a id="dropdownSubMenu1" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="nav-link dropdown-toggle">Dropdown</a>
            <ul aria-labelledby="dropdownSubMenu1" class="dropdown-menu border-0 shadow">
              <li><a href="#" class="dropdown-item">Some action </a></li>
              <li><a href="#" class="dropdown-item">Some other action</a></li>

              <li class="dropdown-divider"></li>


              <li class="dropdown-submenu dropdown-hover">
                <a id="dropdownSubMenu2" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-item dropdown-toggle">Hover for action</a>
                <ul aria-labelledby="dropdownSubMenu2" class="dropdown-menu border-0 shadow">
                  <li>
                    <a tabindex="-1" href="#" class="dropdown-item">level 2</a>
                  </li>


                  <li class="dropdown-submenu">
                    <a id="dropdownSubMenu3" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="dropdown-item dropdown-toggle">level 2</a>
                    <ul aria-labelledby="dropdownSubMenu3" class="dropdown-menu border-0 shadow">
                      <li><a href="#" class="dropdown-item">3rd level</a></li>
                      <li><a href="#" class="dropdown-item">3rd level</a></li>
                    </ul>
                  </li>


                  <li><a href="#" class="dropdown-item">level 2</a></li>
                  <li><a href="#" class="dropdown-item">level 2</a></li>
                </ul>
              </li>

            </ul>
          </li>
        </ul>

      </div>
    -->
      
    </div>
  </nav>
  <!-- /.navbar -->

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
      <div class="container">
        <div class="row mb-2">
          <div class="col-sm-12 col-md-12 col-lg-8 offset-lg-2">
            <h1 class="m-0 text-center"> <?=$templateJudul?></h1>
          </div><!-- /.col -->
          
        </div><!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->

    <!-- Main content -->
    <div class="content">
      <div class="container">
        <div class="row">
            <div class="col-sm-12 col-md-12 col-lg-8 offset-lg-2">
                <form class="form-horizontal" id="form_pendaftaran" enctype="multipart/form-data">
                        
                    <div class="card card-primary card-outline">
                            
                        <div class="card-body">
                            <!-- START DATA AKADEMIK -->
                            <div class="form-group">
                                <label class="col-form-label">Program Studi <code>*</code> </label>
                                
                                <?php
                                
                                echo cmb_dinamis('prodi', 'prodi', 'nm_prodi', 'singkatan', null, null, 'id="prodi" style="width: 100%;"');
                                ?>
                                <div class="invalid-feedback"></div>
                            </div>

                            <div class="form-group">
                                <label class="col-form-label">Nama <code>*</code> </label>
                                
                                <select name="m" id="m" class="form-control select2" style="width: 100%;">
                                                
                                </select>
                                <input type="text" class="form-control" id="id_mhs" name="id_mhs" hidden/>

                                <div class="invalid-feedback"></div>
                            </div>

                            <div class="form-group">
                                <label class="col-form-label">Tahun Lulus <code>*</code> </label>
                                
                                
                                <div class="input-group date" id="reservationdate-tahun-lulus" data-target-input="nearest">
                                    <input type="text" class="form-control datetimepicker-input" id="tahun_lulus" data-toggle="datetimepicker" name="tahun_lulus"
                                        data-target="#reservationdate-tahun-lulus" placeholder="YYYY" />
                                    <div class="input-group-append" data-target="#reservationdate-tahun-lulus" data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                    <div class="invalid-feedback">

                                    </div>
                                </div>
                                
                            </div>

                            <div class="form-group">
                                <label class="col-form-label">No HP <code>*</code></label>
                                    <input type="text" class="form-control" id="no_hp" name="no_hp" />

                                    <div class="invalid-feedback"></div>
                            </div>

                            <div class="form-group">
                                <label class="col-form-label">Pekerjaan Pertama setelah lulus sarjana <code>*</code></label>
                                    <input type="text" class="form-control" id="pekerjaan_pertama" name="pekerjaan_pertama" />

                                    <div class="invalid-feedback"></div>
                            </div>

                            <div class="form-group">
                                <label class="col-form-label">Pekerjaan Selanjutnya atau Pekerjaan saat ini <code>*</code></label>
                                    <input type="text" class="form-control" id="pekerjaan_saat_ini" name="pekerjaan_saat_ini" />

                                    <div class="invalid-feedback"></div>
                            </div>

                            <div class="form-group">
                                <label class="col-form-label">Nama Perusahaan/Institusi tempat kerja saat ini <code>*</code></label>
                                    <input type="text" class="form-control" id="nama_instansi" name="nama_instansi" />

                                    <div class="invalid-feedback"></div>
                            </div>

                            <div class="form-group">
                                <label class="col-form-label">Kapan anda mulai mencari pekerjaan? Mohon pekerjaan sambilan tidak dimasukkan <code>*</code> </label>
                                
                                <?php
                                
                                echo cmb_dinamis('mulai_mencari', 'ref_option', 'opt_val', 'opt_id', null, null, 'id="mulai_mencari" style="width: 100%;"', null, null, ['opt_group' => 'mulai_mencari_kerja']);
                                ?>
                                <div class="invalid-feedback"></div>
                            </div>

                            <div class="form-group">
                                <label class="col-form-label">Berapa bulan waktu yang dihabiskan (sebelum dan atau sesudah kelulusan) untuk memperoleh pekerjaan pertama? <code>*</code> </label>
                                
                                <?php
                                
                                echo cmb_dinamis('waktu_tunggu', 'ref_option', 'opt_val', 'opt_id', null, null, 'id="waktu_tunggu" style="width: 100%;"', null, null, ['opt_group' => 'waktu_tunggu']);
                                ?>
                                <div class="invalid-feedback"></div>
                            </div>

                            <div class="form-group">
                                <label class="col-form-label">Seberapa erat hubungan antara bidang studi dengan pekerjaan anda? <code>*</code> </label>
                                
                                <?php
                                
                                echo cmb_dinamis('hubungan_ps_dengan_kerja', 'ref_option', 'opt_val', 'opt_id', null, null, 'id="hubungan_ps_dengan_kerja" style="width: 100%;"', null, null, ['opt_group' => 'hub_ps_kerja']);
                                ?>
                                <div class="invalid-feedback"></div>
                            </div>

                            <div class="form-group">
                                <label class="col-form-label">Diisi Pada Tanggal <code>(*)</code></label>

                                    <div class="input-group date" id="reservationdate"
                                        data-target-input="nearest">
                                        <input type="text" class="form-control datetimepicker-input"
                                            id="dibuat_pada" data-toggle="datetimepicker" name="dibuat_pada"
                                            data-target="#reservationdate" placeholder="YYYY-MM-DD" />
                                        <div class="input-group-append" data-target="#reservationdate"
                                            data-toggle="datetimepicker">
                                            <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                        </div>
                                        <div class="invalid-feedback">

                                        </div>
                                    </div>
                            </div>
                                
                            <!-- END DATA AKADEMIK -->
                            
                            
                        </div>
                        
                        <div class="card-footer">
                            <button type="button" class="btn btn-primary" onclick="simpan()">Simpan </button>
                        </div>
                        
                    </div>
                    <!-- /.card -->
                    
                        
                </form>
            </div>
            <!-- /.col-lg-8 -->
            
            
            <!-- /.col-lg-4 -->
        </div>
        <!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->

  <!-- Main Footer -->
  <footer class="main-footer">
    <!-- To the right -->
    <div class="float-right d-none d-sm-inline">
      Anything you want
    </div>
    <!-- Default to the left -->
    <strong>Copyright &copy; <a href="https://iaibafa.ac.id">IAIBAFA</a>.</strong> All rights reserved.
  </footer>
</div>
<!-- ./wrapper -->

<!-- REQUIRED SCRIPTS -->

<!-- jQuery -->
<script src="<?=base_url('assets');?>/plugins/jquery/jquery.min.js"></script>
<!-- jQuery UI 1.11.4 -->
<script src="<?=base_url('assets');?>/plugins/jquery-ui/jquery-ui.min.js"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
$.widget.bridge('uibutton', $.ui.button)
</script>
<!-- daterangepicker -->
<script src="<?=base_url('assets');?>/plugins/moment/moment.min.js"></script>
<script src="<?=base_url('assets');?>/plugins/daterangepicker/daterangepicker.js"></script>
<script src="<?=base_url('assets');?>/plugins/inputmask/jquery.inputmask.min.js"></script>
<!-- Tempusdominus Bootstrap 4 -->
<script src="<?=base_url('assets');?>/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
<script src="<?=base_url('assets');?>/plugins/owlcarousel/owl.carousel.js"></script>
<!-- Select2 -->
<script src="<?=base_url('assets');?>/plugins/select2/js/select2.full.min.js"></script>
<!-- Bootstrap 4 -->
<script src="<?=base_url('assets');?>/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- SweetAlert2 -->
<script src="<?=base_url('assets');?>/plugins/sweetalert2/sweetalert2.min.js"></script>
<!-- Toastr -->
<script src="<?=base_url('assets');?>/plugins/toastr/toastr.min.js"></script>
<!-- InputMask -->
<script src="<?=base_url('assets');?>/plugins/inputmask/jquery.inputmask.min.js"></script>
<!-- overlayScrollbars -->
<script src="<?=base_url('assets');?>/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
<!-- AdminLTE App -->
<script src="<?=base_url('assets');?>/dist/js/adminlte.js"></script>

<script>
var table_mk;
$(function() {

    $('.select2').select2({
        placeholder: "----Pilih Opsi----",
        allowClear: true
    });
    $(document).on('select2:open', () => {
        document.querySelector('.select2-search__field').focus();
    });
    
    $('#reservationdate, #reservationdate_ayah, #reservationdate_ibu, #tgl_masuk_date').datetimepicker({
        format: 'YYYY-MM-DD',
        viewMode: 'years'
    });

    $('#reservationdate-tahun-lulus').datetimepicker({
        format: 'YYYY',
        viewMode: 'years'
    });
    
    // Autocomplete Select2
    $('#Prov').select2({
        placeholder: '--- Cari Propinsi ---',
        minimumInputLength: 1,
        allowClear: true,
        ajax: {
            url: '<?=base_url('admin/globalController/getWilayahAutoComplete')?>',
            dataType: 'json',
            delay: 250,
            data: function(params) {
                return {
                    search: params.term,
                    page: params.page,
                    field: 'provinsi',
                    groupBy: 'provinsi',
                };

            },
            processResults: function(data, params) {
                params.page = params.page || 1;
                return {
                    results: data,
                    pagination: {
                        more: (params.page * 5) < data.length
                    }
                };
            },
            cache: true
        }

    });
    $('#Kab').select2({
        placeholder: '--- Cari Kabupaten ---',
        minimumInputLength: 1,
        allowClear: true,
        ajax: {
            url: '<?=base_url('admin/globalController/getKabAutoComplete')?>',
            dataType: 'json',
            delay: 250,
            data: function(params) {
                return {
                    search: params.term,
                    page: params.page,
                    field: 'kabupaten',
                    groupBy: 'kabupaten',
                    whereProp: $('#Prov option:selected').val(),
                };

            },
            processResults: function(data, params) {
                params.page = params.page || 1;
                return {
                    results: data,
                    pagination: {
                        more: (params.page * 5) < data.length
                    }
                };
            },
            cache: true
        }

    });
    $('#Kec').select2({
        placeholder: '--- Cari Kecamatan ---',
        minimumInputLength: 1,
        allowClear: true,
        ajax: {
            url: '<?=base_url('admin/globalController/getKecAutoComplete')?>',
            dataType: 'json',
            delay: 250,
            data: function(params) {
                return {
                    search: params.term,
                    page: params.page,
                    field: 'kecamatan',
                    groupBy: 'kecamatan',
                    whereProp: $('#Prov option:selected').val(),
                    whereKab: $('#Kab option:selected').val(),
                };

            },
            processResults: function(data, params) {
                params.page = params.page || 1;
                return {
                    results: data,
                    pagination: {
                        more: (params.page * 5) < data.length
                    }
                };
            },
            cache: true
        }

    });
    $('#Desa').select2({
        placeholder: '--- Cari Desa ---',
        minimumInputLength: 1,
        allowClear: true,
        ajax: {
            url: '<?=base_url('admin/globalController/getDesaAutoComplete')?>',
            dataType: 'json',
            delay: 250,
            data: function(params) {
                return {
                    search: params.term,
                    page: params.page,
                    field: 'kelurahan',
                    groupBy: '',
                    whereProp: $('#Prov option:selected').val(),
                    whereKab: $('#Kab option:selected').val(),
                    whereKec: $('#Kec option:selected').val(),
                };

            },
            processResults: function(data, params) {
                params.page = params.page || 1;
                return {
                    results: $.map(data, function(item) {
                        return {
                            text: item.text + " (" + item.kodepos + ")",
                            id: item.id,
                            kodepos: item.kodepos
                        }
                    }),
                    pagination: {
                        more: (params.page * 5) < data.length
                    }
                };
            },
            cache: true
        }

    }).on('select2:select', function(e) {
        //console.log($(this).select2('data')[0]);
        //var data = $(this).find(':selected').val();
        //console.log($(this).select2('data')[0]);
        var data = $(this).select2('data')[0];
        $('#Kode_Pos').val(data.kodepos);
    });
    
    $('#m').select2({
        placeholder: '--- Ketik Nama / NIM ---',
        minimumInputLength: 1,
        allowClear: true,
        ajax: {
            url: "<?=base_url("$controller/getMhs")?>",
            dataType: 'json',
            delay: 250,
            data: function(params) {
                return {
                    search: params.term,
                    page: params.page,
                    prodi: $('#prodi option:selected').val(),
                };

            },
            processResults: function(data, params) {
                params.page = params.page || 1;
                return {
                    results: $.map(data, function(item) {
                        return {
                            text: item.text,
                            id: item.id,
                            id_mhs: item.id_mhs,
                        }
                    }),
                    pagination: {
                        more: (params.page * 5) < data.length
                    }
                };
            },
            cache: true
        }

    }).on('select2:select', function(e) {
        var data = $(this).select2('data')[0];
        $('#id_mhs').val(data.id_mhs);
    });

})


function simpan() {

    var data = $('#form_pendaftaran').serialize();
    $('#form_pendaftaran').find('.invalid-feedback').text('');
    Swal.fire({
        title: 'Anda yakin akan menyimpan data ??',
        showCancelButton: true,
        confirmButtonText: 'Ya',
        allowOutsideClick: false,
    }).then((result) => {

        if (result.isConfirmed) {
            $.ajax({
                url: "<?php echo site_url("$controller/simpan");?>",
                type: "post",
                data: data,
                dataType: 'json',
                beforeSend: function() {
                    Swal.fire({
                        title: 'Please Wait!!',
                        allowOutsideClick: false,
                        showConfirmButton: false,
                        didOpen: () => {
                            Swal.showLoading()
                        },
                    });
                },
                success: function(data) {
                    Swal.close();
                    if (data.msg == 'success') {
                         Swal.fire({
                            icon: 'success',
                            title: "Tracer Study berhasil disimpan",
                            confirmButtonText: 'OK',
                            allowOutsideClick: false,
                        }).then((result) => {
                            
                            window.location.href = "<?=base_url("$controller")?>";
                        })
                    } else if (data.msg == 'warning'){
                        const myObj = JSON.parse(JSON.stringify(data.validation));
                        let pesan = "";
                        for (const x in myObj) {
                          pesan += myObj[x]+ '<br>' ;
                        }
                        Swal.fire({
                            icon: data.msg,
                            title: data.pesan,
                            //html : pesan ,
                            allowOutsideClick: false,
                        })
                        
                        $.each(data.validation, function(key, value) {
                            
                            $('#' + key).addClass('is-invalid');
                            $('#' + key).parents('.form-group').find('.invalid-feedback').text(value);
                        });
                    }else{
                        Swal.fire({
                            icon: data.msg,
                            title: data.pesan,
                            confirmButtonText: 'OK',
                            allowOutsideClick: false,
                        })
                    }
                },
                error: function(xhr, ajaxOptions, thrownError) {
                    Swal.close();
                    Swal.fire({
                        icon: 'error',
                        title: 'Something Wrong!!',
                        text:thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText,
                        confirmButtonText: 'OK',
                        allowOutsideClick: false,
                    })
                }
            });
        }
    })

}
</script>

</body>
</html>